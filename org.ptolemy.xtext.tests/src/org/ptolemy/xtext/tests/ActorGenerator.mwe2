module org.ptolemy.xtext.tests.ActorGeneratorMWE

import org.eclipse.emf.mwe.utils.*

var targetDir = "src-gen"
var modelPath = "examples/hal/caltrop"

Workflow {

	bean = StandaloneSetup {
//		scanClassPath  = true
		registerGeneratedEPackage = "org.ptolemy.ecore.kernel.KernelPackage"
		registerGeneratedEPackage = "org.ptolemy.ecore.actor.ActorPackage"
		registerGeneratedEPackage = "org.ptolemy.ecore.caltrop.CaltropPackage"
		registerGeneratedEPackage = "org.ptolemy.ecore.xactor.XactorPackage"
	}

	component = org.ptolemy.ecore.xtext.EActorSupport {
	}

    component = DirectoryCleaner {
	    directory = "${targetDir}/hal/caltrop/test/"
    }

	component = org.eclipse.xtext.mwe.Reader {
		register = org.ptolemy.xtext.XActorStandaloneSetup {}

		// lookup all resources on the classpath
//		useJavaClassPath = true

		// or define search scope explicitly
		path = modelPath

		// this class will be generated by the xtext generator 
		uriFilter = org.eclipse.xtext.mwe.NameBasedFilter {
			regularExpression = "(isa\\.xactor$)"
		}
		loadResource = {
			slot = "model"
		}
	}

	component = org.eclipse.xtext.generator.GeneratorComponent {
		register = org.ptolemy.xtext.XActorStandaloneSetup {}

		slot = 'model'
		outlet = {
			path = targetDir
		}
	}
}
